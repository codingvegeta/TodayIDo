## 6 커넥션 풀

---
* 매번 새로운 커넥션을 구하면 동시 접속자가 많은 사이트에서는 성능이 낮아진다.
* 이 문제를 해결하기 위해 커넥션 풀을 사용한다.

### 6.1 커넥션 풀이란

---
* 커넥션 풀이란?
  * 데이터베이스와 연결된 커넥션을 미리 만들어서 풀(pool) 속에 저장해 두고 있다가 필요시마다 커넥션을
  풀에서 가져다 쓰고 다시 풀에 반환하는 기법을 의미한다.
    1. 풀에서 커넥션을 가져온다.
    2. 커넥션을 사용한다.
    3. 커넥션을 풀에 반납한다.
* 커넥션 풀 기법은 풀 속에 데이터베이스와 연결된 커넥션을 미리 생성해 놓는다.
* 커넥션 풀의 특징
  1. 풀 속에 미리 커넥션이 생성되어 있기 때문에 커넥션을 생성하는데 드는 연결 시간을 줄일 수 있다.
  2. 커넥션을 계속해서 재사용하기 때문에 생성되는 커넥션 수가 일정하게 유지된다.
* 커넥션 풀을 사용하면 커넥션을 생성하고 닫는데 필요한 시간이 소모되지 않기 떄문에 어플리케이션의 속도가 빨라진다.
* 한번에 생성될 수 있는 커넥션의 수를 제어하기 때문에 어플리케이션이 쉽게 다운되지 않는다.
* 커넥션 풀 라이브러리는 매우 다양하다.

### 6.2 DBCP를 이용해서 커넥션 풀 사용하기

---
* 자카르다 프로젝트의 DBCP2 API 를 사용할 때에는 다음의 과정을 거치면 된다.
  1. DBCP 관련 jar 파일과 JDBC 드라이버 jar 설치하기
  2. 커넥션 풀 초기화 하기
  3. 커넥션 풀로부터 커넥션 사용하기

#### 6.2.1 필요한 jar 파일 복사하기

* https://commons.aprach.org/
* https://mvnrepository.com/
* 인터넷에서 다운받읍시다..

#### 6.2.2 커넥션 풀 초기화 서블릿 클래스

* /jdbc/DBCPinit 을 보세요! 요악
  1. 실제 커넥션을 생성할 ConnectionFactory를 생성한다.
  2. 커넥션 풀로 사용할 PoolableConnection을 생성하는 PoolableConnectionFactory를 생성한다.
  3. 커넥션 풀의 설정 정보를 생성한다.
  4. 커넥션 풀을 사용할 JDBC 드라이버를 등록한다.
* 커넥션의 유효시간
  * 커넥션의 유효시간이 지나도록 사용이 없으면 DBMS는 커넥션 풀에 있는 모든 커넥션의 연결을 끊는다.
  * 커넥션 풀의 모든 연결이 끊긴 상태에선 DB에 접속할 수 없기 때문에 익셉션이 발생한다.
  * 이런 문제를 방지하기 위해 커넥션이 유효한지 여부를 검사하는 기능을 제공한다.
  * 유효여부를 검사할 때 흔히 사용하는 방법은 쿼리를 실행하는것이다.

### 6.2.3 커넥션 풀 초기화 서블릿 설정

* web.xml에 꼭 등록을 해주어야합니다.

### 6.2.4 커넥션 풀로부터 커넥션 사용하기

* DBCP 가 제공하는 PoolingDriver는 커넥션 풀을 위한 JDBC 드라이버이다.
* PoolingDriver를 통해 커넥션 풀로부터 커넥션을 가져오려면 다음 형식의 JDBC URL을 사용하면 된다.
* >jdbc:apach:commons:dbcp:풀이름
* 

# 클라이언트와의 대화 2: 세션

---

* 쿠키 : 웹 브라우저에 값을 저장한다.
* 세션 : 서버에 값을 저장한다.

## 1. 세션 사용하기 : session 기본 객체

---

* 세션은 웹 컨테이너에 정보를 보관한다.
* 세션은 오직 서버에만 생성된다.
* 웹 컨테이너는 기본적으로 한 웹 브라우저마다 한 세션을 생성한다.
* 같은 JSP 페이지라도 웹 브라우정 따라 서로 다른 세션을 사용한다.

### 1.1 세션 생성하기

---

* JSP 에서 세션을 생성하려면 page 디렉티브의 session 속성을 "true" 로 지정하면 된다.
* ```
  <%@ page contentType=...%>
  <%@ page session = "true"%>
  <%
     ...
     session.setAttribute("userInfo",userInfo)
  %>
  ```
* 하지만 page 디렉티브의 session 속성은 기본값이 true 이므로 session 속성값을 false로 지정
  하지 않으면 생성된다.
* 웹 브라우저가 처음 접속할 때 세션을 생성하고, 이후로는 이미 생성된 세션을 사용한다.

### 1.2 session 기본 객체

---

* session 기본 객체는 속성을 제공하므로 setAttribute(), getAttribute() 등의 메서드를 사용해
  속성값을 저장하거나 읽어올 수 있다.
* 세션은 세션만의 고유 정보를 제공하며, 이들 정보를 구할 때 사용하는 메서드는
    1. getId() : 세션의 고유 ID를 구한다.(세션 ID)
    2. getCreationTime() : 세션이 생성된 시간을 구한다.(1/1000초)
    3. getLastAccessedTime() : 웹 브라우저가 마지막에 세션에 접근한 시간을 구한다.

### 1.3 기본 객체의 속성 사용

---

* 한번 생성된 세션은 지정한 유효시간 동안 유지된다.
* 지속적으로 사용해야 하는 데이터의 저장소로 세션이 적당하다.
* request 객체는 하나의 요청을 처리하는데 사용되는 JSP 에서만 session 객체는
  여러 웹 브라우저의 여러 요청을 처리하는 JSP 페이지 사이에서 공유된다.

```
쿠키 vs 세션
세션은 쿠키보다 보안에서 앞선다.
쿠키의 이름이나 데이터는 네트워크를 통해 전달되기 때문에 http 프로토콜을 사용하는 경우 중간에 누군가
쿠키의 값을 읽어올 수 있지만 세션의 값은 오직 서버에만 저장되기 때문에 중요한 데이터를 저장하기에 알맞다.

웹 브라우저가 쿠키를 지원하지 않거나 강제적으로 쿠키를 막는경우(잘 없음)
세션은 쿠키의 설정 여부에 상관없이 사용이 가능하다.
서블릿/JSP는 쿠키를 사용할 수 없는 경우, URL 재작성 방식을 사용해서 세션ID를 웹 브라우저와
웹 서버가 공유할 수 있다.

하지만 세션은 여러 서버에서 공유할 수 없다.
EX) www.daum.net 과 mail.daum.net의 세션은 다르다
반면에 쿠키는 도메인을 이용해서 쿠키를 여러 도메인 주소에 공유할 수 있다. 
```

### 1.4 세션 종료

---

* 세션을 유지할 필요가 없으면 session.invalidate() 메서드를 사용해서 세션을 종료한다.
* 세션을 종료하면 현재 사용 중인 session 기본 객체를 삭제하고 session 기본 객체에 저장했던
  속성 목록도 함께 삭제한다.

### 1.5 세션 유효 시간

---

* 세션은 최근 접근 시간을 갖는다.
* session 기본 객체를 사용할 때마다 세션의 최근 접근 시간은 갱신된다.
* ```
  session.getLastAccessedTime()
  ```
* 최근에 session 기본 객체에 접근한 시간을 반환한다.
* page 디렉티브의 세션 속성값이 false가 아닌 경우 JSP 페이지를 실행할 때마다
  session 기본 객체에 접근하게 된다.
* 세션은 마지막 접근 이후 일정 시간 이내에 다시 세션에 접근하지 않는 경우 자동으로
  세션을 종료한는 기능을 가지고 있다.
* 세션 유효시간은 두가지 방법으로 설정 할 수 있다.
    1. web.xml 파일에 <session-config> 태그를 사용하여 세션 유효 시간을 지정하는 방법.
   ```
  <session-config>
    <session-timeout> 원 하 는 시 간 </session-timeout>
  </session-config>
  ```
  값을 0 이나 음수로 설정하면 세션은 유효시간을 갖지 않는다.   
  session.invalidate() 메서드가 호출되기 전까지 서버에 유지된다.   
  즉, 세션 객체가 메모리에 계속 남게되어 메모리 부족 현상이 발생하게 된다.

    2. session 기본 객체가 제공하는 setMaxInactiveInterval()
  ```
  <%
    session.setMaxInactiveInterval(1/1000초 단위);
  %>
  ```

### 1.6 request.getsession()을 이용한 세션 생성

---
* HttpSession을 생성하는 또 다른 방법은 request 기본 객체의 getSession() 메서드를 사용하는 것이다.

* request.getSession() 을 이용해서 세션을 구하기 때문에 page 디렉티브의 session
 속성값을 flase로 지정한다.
* request.getSession()메서드를 실행하면 세션이 존재하는 경우에만 session 객체를 리턴하고
 존재하지 않는 경우 session을 새롭게 생성해서 리턴한다.
* 만약 세션이 생성된 경우에만 session 객체를 구하고 싶다면 request.getSession(false)를 입력하면
 session 객체가 없을경우 null 을 반환한다.
* 
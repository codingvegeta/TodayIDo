# 테스트 범위와 종류

---

## 테스트 범위

* 하나의 기능이 올바르게 동작하려면 컨트롤러, 서비스, 모델과 같은 자바 코드와 프레임 워크
  설정에 문제가 없어야 할 뿐 아니라 브라우저에서 실행되는 자바스크립트 코드, HTML과 CSS 등이
  정상 동작해야 한다.
* DB의 테이블도 올바르게 생성되어 있어야 한다.

## 기능 테스트와 E2E 테스트

* 기능 테스트는 사용자 입장에서 시스템이 제공하는 기능이 올바르게 동작하는지 확인한다.
* 이 테스트를 수행하려면 시스템을 구동하고 사용하는데 필요한 모든 구성요소거 필요하다.
* 기능 테스트는 사용자가 직접 사용하는 웹 브라우저나 모바일 앱부터 시작해서 데이터베이스나
  외부 서비스에 이르기까지 모든 구성 요소를 하나로 엮어서 진행한다.
* 이는 끝(브라우저)에서 끝(데이터베이스)까지 모든 구성 요소를 논리적으로 완전한 하나의
  기능으로 다룬다.
* 기능 테스트는 끝에서 끝까지 올바른지 검사하기 때문에 E2E(End to end) 테스트로도 볼 수 있다.

### 읽어보기

* 기능 테스트를 자동화했다면 DB에 보관된 데이터를 삭제하거나 수정하는 것과 같이 DB데이터를
  테스트 코드에서 조작할 수 있지만, 이는 반복적인 기능 테스트를 위한 것이지 기능 테스트 결과를
  검증하기 위한 용도는 아니다.

## 통합 테스트

* 통합 테스트는 시스템의 각 구성 요소가 올바르게 연동되는지 확인한다.
* 소프트웨어의 코드를 직접 테스트 한다.
* 일반적인 웹 어플리케이션은 프레임워크, 라이브러리, 데이터베이스, 구현한 코드가 주요 통합
  테스트 대상이다.

## 단위 테스트

* 단위 테스트는 개별 코드나 컴포넌트가 기대한대로 동작하는지 확인한다.
* 단위 테스트는 한 클래스나 한 메서드와 같은 작은 범위를 테스트한다.
* 일부 의존 대상은 스텁이나 모의 객체 등을 이용해서 대역으로 대체한다.

## 테스트 범위 간 차이

* TDD를 하는지 여부에 상관없이 테스트 코드를 작성하는 개발자는 단위 테스트와 통합 테스트를
  섞어서 작성한다.
* 통합 테스트를 실행하려면 준비할 것이 많고 단위 테스트에 비해 실행 시간도 길지만,
  그래도 통합 테스트는 필요하다.
* 아무리 많은 단위테스트를 만들어도 각 구성 요소가 올바르게 연동되는 것을 확인해야 하는데
  이를 자동화하기 좋은 수단이 통합 테스트 코드이기 때문이다.

## 테스트 범위에 따른 테스트 코드 개수와 시간

* 기능 테스트, 통합 테스트, 단위 테스트 등 전 범위에 대해 테스트를 자동화하는 시도가 증가
  하고 있다.
* 테스트를 자동화하는 만큼 고품질의 소프트웨어를 더 빠르게 출시할 수 있기 때문이다.
* 테스트를 자동화한다는 것은 결국 코드로 작성한 테스트를 실행한다는 것을 의미한다.
* 단위 테스트는 통합 테스트로도 만들기 힘든 상황을 쉽게 구성할 수 있다.

## 외부 연동이 필요한 테스트 예

* 소프트웨어는 다양한 외부 연동이 필요하다.
* 모든 외부 연동 대상을 통합 테스트에서 다룰 수 없지만, 일부 외부 대상은 어느정도 수준에서
  제어가 가능하다.

## WireMock을 이용한 REST 클라이언트 테스트

* WireMockServer는 HTTP 서버를 흉내낸다.
    * 테스트 실행 전에 WoreMockServer를 시작한다. 실제 HTTP 서버가 뜬다.
    * 테스트에서 WireMockServer의 동작을 기술한다.
    * HTTP 연동을 수행하는 테스트를 실행한다.
    * 테스트 실행 후에 WireMockServer를 중지한다.
* WireMock은 JSON/XML 응답, HTTPS 지원, 단독 실행 등 다양한 기능을 제공하므로
  외부 연동 코드를 테스트할 때 유용하게 사용할 수 있다.

## 스프링 부트의 내장 서버를 이용한 API 기능 테스트

* 스프링 부트를 사용한다면 내장 톰캣을 이용해서 API에 대한 테스트를 JUnit 코드로
작성할 수 있다.
* 스프링 부트는 테스트에서 웹 환경을 구동할 수 있는 기능을 제공한다.
* 이 테스트는 이 기능을 사용해서 내장 서버를 구동하고 스프링 웹 어플리케이션을 실행한다.
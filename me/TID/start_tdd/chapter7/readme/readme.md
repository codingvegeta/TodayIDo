# 대역

---

## 대역의 필요성

* 테스트를 작성하다 보면 외부 요인이 필요한 시점이 있다.
    * 테스트 대상에서 파일 시스템을 사용
    * 테스트 대상에서 DB로부터 데이터를 조회하거나 데이터를 추가
    * 테스트 대상에서 외부의 HTTP 서버와 통신
* 테스트 대상이 외부 요인에 의존하면 테스트를 작성하고 실행하기 어려워진다.
* 외부 요인은 테스트 작성을 어렵게 만들 뿐만 아니라 테스트 결과도 예측할 수 없게 만든다.

## 대역의 종류

* 스텁(stub) 구현을 단순한 것으로 대체한다. 테스트에 맞게 단순히 원하는 동작을 수행한다.
* 가짜(fake) 제품에는 적합하지 않지만, 실제 동작하는 구현을 제공한다. DB 대신에 메모리를 이용해
구현한 가짜 대역에 해당한다.
* 스파이(spy) 호출된 내역을 기록한다. 기록한 내용은 테스트 결과를 검증할 때 사용한다.
* 모의(Mock) 기대한 대로 상호작용하는지 행위를 검증한다. 기대한 대로 동작하지 않으면 익셉션을 
발생할 수도 있다.

## 상황과 결과 확인을 위한 협업 대상(의존) 도출과 대역 사용

* 한 테스트는 특정한 상황에서 기능을 실행하고 결과를 확인한다.
* 실제 구현을 이용하면 상황을 만들기 어려울 때가 많다.
* 제어하기 힘든 외부 상황이 존재하면 다음과 같은 방법으로 도출하고 역으로 대신할 수 있다.
  * 제어하기 힘든 외부 상황을 별도 타입으로 분리
  * 테스트 코드는 별도로 분리한 타입의 대역을 생성
  * 생성한 대역을 테스트 대상의 생성자 등을 이용해서 전달
  * 대역을 이용해서 상황 구성

## 대역과 개발 속도

* 대역을 사용하면 실제 구현이 없어도 실행 결과를 확인할 수 있다.
* DB가 없어도 회원 데이터가 올바르게 저장되는지 확인할 수 있고 메일 서버가 없어도
이메일 발송 요청을 하는지 확인할 수 있다.
* 대역은 의존하는 대상을 구현하지 않아도 테스트 대상을 완성할 수 있게 만들어주며 이는 
대기 시간을 줄여주어 개발 속도를 올리는데 도움이 된다.

## 모의 객체를 과하게 사용하지 않기

* 모의 객체를 이용하면 대역 클래스를 만들지 않아도 되니까 처음에는 편할 수 있다.
* 하지만 결과 값을 확인하는 수단으로 모의 객체를 사용하기 싲가하면 결과 검증 코드가 길어지고
복잡도는 배로 증가한다.
* 모의 객체는 기본적으로 메서드 호출 여부를 검증하는 수단이기 때문에 테스트 대상과 모의
객체 간의 상호 작용이 조금만 바뀌어도 테스트가 깨지기 쉽다.
* DAO 나 레포지토리와 같이 저장소에 대한 대역은 모의 객체를 사용하는 것보다 메모리를 이용한
가짜 구현을 사용하는 것이 테스트 코드 관리에 유리하다.
# Mockito 기초 사용법

---

* Mockito는 모의 객체 생성, 검증, 스텁을 지원하는 프레임 워크다.

## 모의 객체 생성

* Mockito.mock() 메서드를 이용하면 특정 타입의 모의객체를 생성할 수 있다.
* Mockito.mock() 메서드는 클래스, 인터페이스, 추상클래스에 대해 모의 객체를 생성할 수 있다.

## 스텁 설정

* 모의 객체를 생성한 뒤에는 BDDMockito 클래스를 이용해서 모의 객체에 스텁을 구성할 수 있다.
* BDDMockito.given() 메서드는 스텁을 정의할 모의 객체에 메서드 호출을 전달한다.
* willReturn() 메서드는 스텁을 정의한 메서드가 리턴할 값을 지정한다.
* 타입 대신에 익셉션 객체를 인자로 받는 willThrow() 메서드를 사용해도 된다.
* 리턴타입이 void인 메서드에 대해 익셉션을 발생하려면 BDDMockito.willThrow() 메서들 시작한다.

## 인자 매칭 처리

* Mockito는 일치하는 스텁 설정이 없을 경우 리턴 타입의 기본 값을 리턴한다.
* ArgumentMatchers 클래스를 사용하면 정확하게 일치하는 값 대신 임의의 값에 일치하도록 설정할
  수 있다.

### ArgumentMatchers 클래스가 제공하는 메서드

* anyInt() , any(기본형...) : 기본 데이터 타입에 대한 임의 값 일치
* anyString() : 문자열에 대한 임의 값 일치
* any() : 임의 타입에 대한 일치
* anyList() , any(컬렉션...) : 임의 컬렉션에 대한 일치
* matches(String), matches(Pattern) : 정규표현식을 이용한 String 값 일치 여부
* eq(값) : 특정 값과 일치 여부

### 스텁을 설정할 메서드의 인자가 두개 이상인 경우 주의할 점

* ArgumentMatchers의 메서드는 내부적으로 인자의 일치 여부를 판단하기 위해 ArgumentMatchers
를 등록한다.
* Mockito는 한 인자라도 ArgumentMatchers를 사용해서 설정한 경우 모든 인자를 ArgumentMatchers를
* 이용해서 설정하도록 하고 있다.
* 임의의 값과 일치하는 인자와 정확하게 일치하는 인자를 함께 사용하고 싶다면 ArgumentMatchers.eq()
메서드를 사용해야 한다.

## 행위 검증

* 모의 객체의 역할 중 하나는 실제로 모의 객체가 불렸는지 검증하는 것이다.

### 메서드 호출 횟수를 검증하기 위해 Mockito 클래스가 제공하는 메서드

    then(mock).should(호출회수검증).메서드(타입)
* only() : 한 번만 호출
* times(int) : 지정한 횟수만큼 호출
* never() : 호출하지 않음
* atLeast(int) : 적어도 지정한 횟수만큼 호출
* atLeastOnce() : atLeast(1)과 동일
* atMost(int) : 최대 지정한 횟수만큼 호출

## 인자 캡쳐

* 단위 테스트를 실행하다 보면 모의 객체를 호출할 때 사용한 인자를 검증해야 할 때가 있다.
* 많은 속성을 가진 객체는 쉽게 검증하기 어렵다.
* Mockito의 ArgumentCaptor를 사용하면 메서드 호출 여부를 검증하는 과정에서 실제 호출할 때
전달한 인자를 보관할 수 있다.

## JUnit5 확장 설정

* 애노테이션을 이용해서 모의 객체를 생성할 수 있다.
* @Mock 애노테이션을 붙인 필드에 대해 자동으로 모의 객체를 생성해 준다.